<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Velocity Society Club Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;500&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background:linear-gradient(135deg, rgba(10,0,25,.9), rgba(0,10,30,.92));
  color:#eaffff;
}
.container{
  margin:14px; padding:22px; border-radius:26px;
  background:rgba(8,8,20,.65); border:1px solid rgba(0,255,255,.25);
}
h1,h2,h3,h4{text-align:center;}
h1{font-family:"Playfair Display",serif;letter-spacing:3px;}
h2{font-size:13px;letter-spacing:4px;color:#9befff;}
label{font-size:11px;letter-spacing:1px;color:#ff7cff;}
input, select, textarea{
  width:100%; box-sizing:border-box; padding:12px; margin-bottom:12px;
  border-radius:8px; background:#000; color:#eaffff; border:1px solid #00eaff; font-size:16px;
}
textarea{resize:none;}
button{
  width:100%; padding:14px; border-radius:28px; font-family:"Playfair Display",serif; letter-spacing:3px;
  border:1px solid rgba(0,255,255,.6); cursor:pointer;
  background:linear-gradient(120deg,#ff00cc,#00eaff,#ff00cc); background-size:200% 100%; color:#000;
  transition:background-position .6s ease, transform .15s ease;
}
button:hover{ background-position:100% 0; transform:translateY(-2px);}
button:active{ transform:scale(.97); }
.menu-btns{ display:flex; justify-content:center; gap:12px; margin-bottom:20px;}
.log{margin-top:26px;}
.log-table{ max-height:300px; overflow-y:auto; border-top:1px solid rgba(0,255,255,.25);}
.log-row{display:grid;grid-template-columns:40px 100px 80px 90px 80px 80px 140px; gap:6px; padding:8px;font-size:12px;border-bottom:1px solid rgba(0,255,255,.15);}
.log-head{ font-weight:bold;color:#9befff;position:sticky;top:0;background:#000;}
.status{display:flex;justify-content:center;align-items:center;}
.status.present::before{content:"âœ”";color:#00ff99}
.status.absent::before{content:"âœ–";color:#ff4d4d}
  #welcomeMsg{
  font-family: "Playfair Display", serif;
  font-size: 20px;
  text-align: center;
  line-height: 1.6;
  margin: 20px auto 30px auto;
  max-width: 420px;
  color: #eaffff;
  letter-spacing: 1px;
  text-shadow: 0 0 12px rgba(0,255,255,.25);
  min-height: 90px;
  transition: opacity .5s ease;
}

#menuBtns{
  justify-content: center;
  opacity: 0;
  transition: opacity .6s ease;
}
  .menu-btns, .social-btns {
  display: flex;
  justify-content: center;
  gap: 16px;
  margin-top: 20px;
}

.social-btns a svg {
  width: 40px;
  height: 40px;
  transition: transform 0.3s ease;
}

.social-btns a:hover svg {
  transform: scale(1.2);
}
</style>
</head>
<body>
<div class="container">
<h1>VELOCITY SOCIETY CLUB</h1>
<h2 id="welcomeMsg"></h2>

<!-- Menu -->
<div class="menu-btns" id="menuBtns" style="display:none;">
  <button type="button" onclick="chooseActivity('attendance')">Attendance</button>
  <button type="button" onclick="chooseActivity('fillup')">Fill Up Form</button>
</div>

  <div class="social-btns" id="socialBtns" style="display:none;">
  <!-- Facebook SVG Icon -->
  <a href="https://facebook.com/YourPage" target="_blank" title="Facebook">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="#1877F2" xmlns="http://www.w3.org/2000/svg">
      <path d="M22.675 0H1.325C0.59375 0 0 0.59375 0 1.325V22.675C0 23.4063 0.59375 24 1.325 24H12.82V14.708H9.692V11.146H12.82V8.412C12.82 5.317 14.693 3.578 17.445 3.578C18.779 3.578 19.925 3.673 20.262 3.709V6.924L18.356 6.925C16.872 6.925 16.6 7.627 16.6 8.606V11.146H20.145L19.658 14.708H16.6V24H22.675C23.4063 24 24 23.4063 24 22.675V1.325C24 0.59375 23.4063 0 22.675 0Z"/>
    </svg>
  </a>

  <!-- Telegram SVG Icon -->
  <a href="https://t.me/YourChannel" target="_blank" title="Telegram">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="#0088cc" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 0C5.375 0 0 5.375 0 12C0 18.625 5.375 24 12 24C18.625 24 24 18.625 24 12C24 5.375 18.625 0 12 0ZM17.625 8.25L16.125 17.625C16.125 17.625 15.75 18.375 15 17.875L11.625 15.125L10.875 14.625L7.5 13.125C7.5 13.125 7.125 12.875 7.125 12.25C7.125 11.625 7.5 11.375 7.5 11.375L17.625 8.25ZM10.125 13.875L15.375 7.125C15.375 7.125 15.625 6.875 15 7.125L9 10.125L10.125 13.875Z"/>
    </svg>
  </a>
  </div>

<!-- Attendance Section -->
<div id="attendanceSection" style="display:none;">
  <label>NAME</label>
  <input id="name">
  <label>CPM ID</label>
  <input id="cpm">
  <label>DATE</label>
  <input id="date" readonly>
  <label>TIME</label>
  <input id="time" readonly>
  <label>ABSENT</label>
  <input id="absent" placeholder="YES if absent">
  <label>REASON</label>
  <input id="reason">
  <button type="button" onclick="confirmEntry()">CONFIRM</button>

  <div class="log">
    <div style="text-align:center;margin-bottom:12px">
      <h3 id="countDisplay">0 / 0 Members</h3>
      <h4 id="rateDisplay"></h4>
    </div>

    <div id="absentBox" style="margin-bottom:12px">
      <strong>ABSENT MEMBERS:</strong>
      <ul id="absentList" style="font-size:13px;margin-top:6px"></ul>
    </div>

    <h3>LIVE LOG</h3>
    <div class="log-table">
      <div class="log-row log-head">
        <div></div><div>NAME</div><div>CPM</div><div>DATE</div><div>TIME</div><div>ABSENT</div><div>REASON</div>
      </div>
      <div id="logList"></div>
    </div>
    <button style="margin-top:12px" type="button" onclick="resetRecords()">RESET (ADMIN)</button>
  </div>
</div>

<!-- Fill Up Form Section -->
<div id="fillupSection" style="display:none;">
  <div style="text-align:center;margin-bottom:12px;">
    <img loading="lazy" src="logo.png" alt="Club Logo" width="120">
    <h2>Join Velocity Society Club</h2>
  </div>

  <label>Name</label>
  <input id="fName" type="text">

  <label>Age</label>
  <select id="fAge"><option value="">Select Age</option></select>

  <label>CPM ID</label>
  <input id="fCpm" type="text">

  <label>IGN</label>
  <input id="fIgn" type="text">

  <label>Role</label>
  <select id="fRole">
    <option value="">Select Role</option>
    <option value="Photographer">Photographer</option>
    <option value="Videographer">Videographer</option>
    <option value="Editor">Editor</option>
    <option value="Event Manager">Event Manager</option>
  </select>

  <label>Club Before & Reason for Joining</label>
  <textarea id="fReason" rows="3"></textarea>

  <label>Upload Image</label>
  <input id="fImage" type="file" accept="image/*">

  <button type="button" onclick="submitFillupForm()">Submit</button>
</div>
</div>

<script type="module">
import { members, TOTAL_MEMBERS } from "./member.js";
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC2Qqjc4Z-za60nya2ANMOP6DwQQx5IoE",
  authDomain: "attendance-f8237.firebaseapp.com",
  databaseURL: "https://attendance-f8237-default-rtdb.firebaseio.com",
  projectId: "attendance-f8237",
  storageBucket: "attendance-f8237.firebasestorage.app",
  messagingSenderId: "100172798142",
  appId: "1:100172798142:web:28582310d09ae203b066ef"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);





for(let i=17;i<=50;i++){
  document.getElementById("fAge").innerHTML += `<option value="${i}">${i}</option>`;
}


window.chooseActivity = function(act){
  if(act === "attendance"){
    const userCpm = prompt("Enter your CPM ID:").trim();
    const userName = prompt("Enter your Name:").trim().toLowerCase();
    const validMember = members.some(m => m.cpm === userCpm && m.name.toLowerCase() === userName);
    if(!validMember){
      alert("You are not a member. Please choose the correct activity.");
      return;
    }
    document.getElementById("attendanceSection").style.display="block";
    document.getElementById("fillupSection").style.display="none";
  } else if(act === "fillup"){
    document.getElementById("fillupSection").style.display="block";
    document.getElementById("attendanceSection").style.display="none";
  }
};


const dateInput = document.getElementById("date");
const timeInput = document.getElementById("time");
setInterval(()=>{
  const now = new Date();
  if(dateInput) dateInput.value = now.toISOString().slice(0,10);
  if(timeInput) timeInput.value = now.toTimeString().slice(0,8);
},1000);


window.confirmEntry = function(){
  const name = document.getElementById("name").value.trim();
  const cpm  = document.getElementById("cpm").value.trim();
  if(!name || !cpm){ return alert("Name & CPM ID required"); }
  const validMember = members.find(m => m.cpm === cpm && m.name.toLowerCase() === name.toLowerCase());
  if(!validMember){ return alert("You are NOT a member"); }

  const absent = document.getElementById("absent").value.trim().toUpperCase() || "NO";
  const reason = document.getElementById("reason").value;

  push(ref(db,"attendance"), { name, cpm, date: dateInput.value, time: timeInput.value, absent, reason });
  ["name","cpm","absent","reason"].forEach(id => document.getElementById(id).value="");
};

const logList = document.getElementById("logList");
const countDisplay = document.getElementById("countDisplay");
const rateDisplay  = document.getElementById("rateDisplay");
const absentList = document.getElementById("absentList");

onValue(ref(db,"attendance"), snap=>{
  logList.innerHTML=""; absentList.innerHTML="";
  const data = snap.val() || {};
  const records = Object.values(data);
  const presentCPM = new Set(records.filter(r => r.absent !== "YES").map(r => r.cpm));
  const presentCount = presentCPM.size;
  countDisplay.innerText = `${presentCount} / ${TOTAL_MEMBERS} Members`;

  let rate = "BAD";
  if(presentCount === TOTAL_MEMBERS) rate = "COMPLETE ðŸŽ‰";
  else if(presentCount >= TOTAL_MEMBERS * 0.9) rate = "VERY GOOD âœ…";
  else if(presentCount >= TOTAL_MEMBERS * 0.7) rate = "GOOD ðŸ‘";
  rateDisplay.innerText = rate;

  members.forEach(m=>{
    if(!presentCPM.has(m.cpm)){
      const li = document.createElement("li");
      li.textContent = `${m.name} (${m.cpm})`;
      absentList.appendChild(li);
    }
  });

  records.reverse().forEach(r=>{
    const row = document.createElement("div");
    row.className="log-row";
    row.innerHTML=`
      <div class="status ${r.absent==="YES"?"absent":"present"}"></div>
      <div>${r.name}</div>
      <div>${r.cpm}</div>
      <div>${r.date}</div>
      <div>${r.time}</div>
      <div>${r.absent}</div>
      <div>${r.reason||""}</div>`;
    logList.appendChild(row);
  });
});

window.resetRecords = function(){
  const pass = prompt("Owner password:");
  if(pass!=="cris123") return alert("Incorrect password");
  if(confirm("Delete ALL records?")) remove(ref(db,"attendance"));
};


window.submitFillupForm = function(){
  const name = document.getElementById("fName").value.trim();
  const age  = document.getElementById("fAge").value;
  const cpm  = document.getElementById("fCpm").value.trim();
  const ign  = document.getElementById("fIgn").value.trim();
  const role = document.getElementById("fRole").value;
  const reason = document.getElementById("fReason").value.trim();
  const imageFile = document.getElementById("fImage").files[0];

  if(!name || !age || !cpm || !ign || !role || !reason || !imageFile){
    return alert("Please fill all fields and upload an image.");
  }

  const BOT_TOKEN = "8389171340:AAH9WLzcrTzTUpNXIK3hmWso_mMMc_9jMB0";
  const CHAT_ID   = "6784382795";

  const caption = `
ðŸ“Œ New Club Registration
*Name:* ${name}
*Age:* ${age}
*CPM ID:* ${cpm}
*IGN:* ${ign}
*Role:* ${role}
*Club Before & Reason:* ${reason}
  `;

  const formData = new FormData();
  formData.append("chat_id", CHAT_ID);
  formData.append("photo", imageFile);
  formData.append("caption", caption);
  formData.append("parse_mode", "Markdown");

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method:"POST", body:formData })
    .then(res => res.json())
    .then(data => {
      console.log(data);
      if(data.ok){
        alert("Thank you for joining! Please wait for approval.");
        ["fName","fAge","fCpm","fIgn","fRole","fReason","fImage"].forEach(id => document.getElementById(id).value="");
      } else {
        alert("Telegram error: " + data.description);
      }
    })
    .catch(err => {
      console.error(err);
      alert("Failed to send. See console for details.");
    });
};
</script>
  <script type="module" src="welcome.js"></script> 
</body>
</html>
